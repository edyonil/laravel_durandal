/*
 Knockout.punches
 Enhanced binding syntaxes for Knockout 3+
 (c) Michael Best
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 0.1.0
*/
(function(){function f(a,b){h(n(a),"preprocess",b)}function n(a){return"object"===typeof a?a:ko.getBindingHandler(a)||(ko.bindingHandlers[a]={})}function h(a,b,c){if(a[b]){var d=a[b];a[b]=function(a,b,g){if(a=d.call(this,a,b,g))return c.call(this,a,b,g)}}else a[b]=c}function p(a){var b=ko.bindingProvider.instance;if(b.preprocessNode){var c=b.preprocessNode;b.preprocessNode=function(b){var e=c.call(this,b);e||(e=a.call(this,b));return e}}else b.preprocessNode=a}function q(a){if(-1===a.indexOf("|"))return a;
var b=a.match(/"([^"\\]|\\.)*"|'([^'\\]|\\.)*'|\|\||[|:]|[^\s|:"'][^|:"']*[^\s|:"']|[^\s|:"']/g);if(b&&1<b.length){b.push("|");a=b[0];for(var c,d,e=!1,k=!1,g=1;d=b[g];++g)"|"===d?(e&&(":"===c&&(a+="undefined"),a+=")"),e=k=!0):(k?a="ko.filters['"+d+"']("+a:e&&":"===d?(":"===c&&(a+="undefined"),a+=","):a+=d,k=!1),c=d}return a}function l(a,b,c){function d(c){e[c]&&(e[c]=function(d,e){var f=Array.prototype.slice.call(arguments,0);f[1]=function(){var b={};b[a]=e();return b};return ko.bindingHandlers[b][c].apply(this,
f)})}var e=ko.utils.extend({},this);d("init");d("update");e.preprocess&&(e.preprocess=null);ko.virtualElements.allowedBindings[b]&&(ko.virtualElements.allowedBindings[c]=!0);return e}function r(a){return/^([$_a-z][$\w]*|.+(\.\s*[$_a-z][$\w]*|\[.+\]))$/i.test(a)?"function(_x,_y,_z){return("+a+")(_x,_y,_z);}":a}function u(a,b,c){if("{"!==a.charAt(0))return a;a=ko.expressionRewriting.parseObjectLiteral(a);var d=[],e=this._propertyPreprocessors||{};ko.utils.arrayForEach(a,function(a){var b=a.key;a=a.value;
e[b]&&(a=e[b](a,b,c));a&&d.push("'"+b+"':"+a)});return"{"+d.join(",")+"}"}function m(a){return function(b){return"function("+a+"){return("+b+");}"}}function s(a){if(3===a.nodeType&&a.nodeValue&&-1!==a.nodeValue.indexOf("{{")){var b=[],c=function(a){a&&b.push(document.createTextNode(a))},d=function(a){b.push(document.createComment("ko text:"+a));b.push(document.createComment("/ko"))},e=function(a){var b=a.match(/^([\s\S]*?)\{\{([\s\S]*)}}([\s\S]*)$/);if(b){c(b[1]);a=b[2];var f=a.match(/^([\s\S]*?)}}([\s\S]*)\{\{([\s\S]*)$/);
f?(d(f[1]),e(f[2]),d(f[3])):d(a);c(b[3])}else c(a)};e(a.nodeValue);if(1<b.length){if(a.parentNode){for(var f=0;f<b.length;f++)a.parentNode.insertBefore(b[f],a);a.parentNode.removeChild(a)}return b}}}ko.punches={utils:{setBindingPreprocessor:f,setNodePreprocessor:p}};ko.filters={uppercase:function(a){return String.prototype.toUpperCase.call(a)},lowercase:function(a){return String.prototype.toLowerCase.call(a)},"default":function(a,b){return""===a||null==a?b:a},replace:function(a,b,c){return String.prototype.replace.call(a,
b,c)},fit:function(a,b,c,d){if(b&&(""+a).length>b)switch(c=""+(c||"..."),b-=c.length,a=""+a,d){case "left":return c+a.slice(-b);case "middle":return d=Math.ceil(b/2),a.substr(0,d)+c+a.slice(d-b);default:return a.substr(0,b)+c}else return a},json:function(a,b,c){return ko.toJSON(a,c,b)},number:function(a){return(+a).toLocaleString()}};ko.punches.textFilter={preprocessor:q,enableForBinding:function(a){f(a,q)}};var v=/([^\.]+)\.(.+)/,w=ko.getBindingHandler;ko.getBindingHandler=function(a){var b;if(!(b=
w(a)))a:{if(b=a.match(v)){var c=b[1],d=ko.bindingHandlers[c];if(d){b=(d.getNamespacedHandler||l).call(d,b[2],c,a);ko.bindingHandlers[a]=b;break a}}b=void 0}return b};ko.punches.namespacedBinding={defaultGetHandler:l,setDefaultBindingPreprocessor:function(a,b){var c=ko.getBindingHandler(a);if(c){var d=c.getNamespacedHandler||l;c.getNamespacedHandler=function(){return f(d.apply(this,arguments),b)}}},preprocessor:function(a,b,c){if("{"!==a.charAt(0))return a;a=ko.expressionRewriting.parseObjectLiteral(a);
ko.utils.arrayForEach(a,function(a){c(b+"."+a.key,a.value)})},enableForBinding:function(a){f(a,autoNamespacedPreprocess)}};ko.punches.wrappedCallback={preprocessor:r,enableForBinding:function(a){f(a,r)}};ko.punches.preprocessBindingProperty={setPreprocessor:function(a,b,c){a=n(a);a._propertyPreprocessors||(h(a,"preprocess",u),a._propertyPreprocessors={});h(a._propertyPreprocessors,b,c)}};var t=m("$data,$event");ko.punches.expressionCallback={makePreprocessor:m,eventPreprocessor:t,enableForBinding:function(a,
b){b=Array.prototype.slice.call(arguments,1).join();f(a,m(b))}};ko.bindingHandlers.on={getNamespacedHandler:function(a){a=ko.getBindingHandler("event."+a);f(a,t);return a}};ko.punches.interpolationMarkup={preprocessor:s,enable:function(){p(s)}}})();
